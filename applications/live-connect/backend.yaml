apiVersion: apps/v1
kind: Deployment
metadata:
  name: live-connect-backend
  namespace: live-connect
spec:
  replicas: 1
  selector:
    matchLabels:
      app: live-connect-backend
  template:
    metadata:
      labels:
        app: live-connect-backend
    spec:
      containers:
      - name: backend
        image: shjeon97/live-connect-backend:latest
        ports:
        - containerPort: 4000
        resources:
          limits:
            memory: "512Mi"
            cpu: "500m"
          requests:
            memory: "256Mi"
            cpu: "250m"
        livenessProbe:
          httpGet:
            path: /healthz
            port: 4000
          initialDelaySeconds: 30
          periodSeconds: 10
          timeoutSeconds: 5
          failureThreshold: 3
        readinessProbe:
          httpGet:
            path: /healthz
            port: 4000
          initialDelaySeconds: 5
          periodSeconds: 5
          timeoutSeconds: 3
          failureThreshold: 3
        volumeMounts:
        - name: html-content
          mountPath: /usr/share/nginx/html
      volumes:
      - name: html-content
        configMap:
          name: live-connect-backend-html
---
apiVersion: v1
kind: Service
metadata:
  name: live-connect-backend
  namespace: live-connect
spec:
  selector:
    app: live-connect-backend
  ports:
  - port: 4000
    targetPort: 4000
  type: ClusterIP
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: live-connect-backend-html
  namespace: live-connect
data:
  index.html: |
    <!DOCTYPE html>
    <html>
    <head>
        <title>Live Connect Backend API - Communication Services</title>
        <meta charset="utf-8">
        <style>
            body { font-family: Arial, sans-serif; margin: 40px; background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: white; }
            .header { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); padding: 20px; border-radius: 10px; margin-bottom: 20px; }
            .content { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); padding: 20px; border-radius: 10px; }
            .status { background: #10b981; color: white; padding: 10px; border-radius: 5px; }
            .api-section { background: rgba(255,255,255,0.1); padding: 15px; margin: 15px 0; border-radius: 8px; border-left: 4px solid #3b82f6; }
            .endpoint { background: rgba(0,0,0,0.3); color: white; padding: 8px 12px; border-radius: 3px; font-family: monospace; margin: 5px 0; }
            .method { padding: 2px 6px; border-radius: 2px; font-size: 12px; font-weight: bold; margin-right: 8px; }
            .get { background: #10b981; }
            .post { background: #3b82f6; }
            .put { background: #f59e0b; }
            .delete { background: #ef4444; }
            .websocket { background: #8b5cf6; }
            .real-time { background: rgba(139, 92, 246, 0.2); border: 1px solid #8b5cf6; padding: 15px; border-radius: 8px; margin: 15px 0; }
        </style>
    </head>
    <body>
        <div class="header">
            <h1>ğŸ”§ Live Connect Backend API</h1>
            <p>ì‹¤ì‹œê°„ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ ì‹œìŠ¤í…œ ë°±ì—”ë“œ API ì„œë¹„ìŠ¤</p>
        </div>
        <div class="content">
            <div class="status">âœ… Live Connect ë°±ì—”ë“œ API ì„œë¹„ìŠ¤ê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™ ì¤‘ì…ë‹ˆë‹¤</div>
            
            <div class="real-time">
                <h4>ğŸ”— Real-time Connections Active</h4>
                <p>WebSocket ì—°ê²°: wss://live-connect.back-end.kro.kr/ws</p>
                <p>TURN/STUN ì„œë²„: turn://live-connect.back-end.kro.kr:3478</p>
            </div>

            <h3>Available API Endpoints:</h3>
            
            <div class="api-section">
                <h4>ğŸ’¬ Messaging API</h4>
                <div class="endpoint"><span class="method get">GET</span> /api/messages/{roomId} - ì±„íŒ… ë©”ì‹œì§€ ì¡°íšŒ</div>
                <div class="endpoint"><span class="method post">POST</span> /api/messages - ë©”ì‹œì§€ ì „ì†¡</div>
                <div class="endpoint"><span class="method websocket">WS</span> /ws/chat/{roomId} - ì‹¤ì‹œê°„ ì±„íŒ… ì—°ê²°</div>
            </div>

            <div class="api-section">
                <h4>ğŸ“¹ Video/Audio API</h4>
                <div class="endpoint"><span class="method post">POST</span> /api/calls/initiate - í†µí™” ì‹œì‘</div>
                <div class="endpoint"><span class="method post">POST</span> /api/calls/answer - í†µí™” ì‘ë‹µ</div>
                <div class="endpoint"><span class="method delete">DELETE</span> /api/calls/{callId} - í†µí™” ì¢…ë£Œ</div>
                <div class="endpoint"><span class="method websocket">WS</span> /ws/webrtc/{callId} - WebRTC ì‹œê·¸ë„ë§</div>
            </div>

            <div class="api-section">
                <h4>ğŸ  Room Management</h4>
                <div class="endpoint"><span class="method get">GET</span> /api/rooms - í™œì„± ë£¸ ëª©ë¡</div>
                <div class="endpoint"><span class="method post">POST</span> /api/rooms - ìƒˆ ë£¸ ìƒì„±</div>
                <div class="endpoint"><span class="method post">POST</span> /api/rooms/{roomId}/join - ë£¸ ì°¸ê°€</div>
                <div class="endpoint"><span class="method delete">DELETE</span> /api/rooms/{roomId}/leave - ë£¸ ë– ë‚˜ê¸°</div>
            </div>

            <div class="api-section">
                <h4>ğŸ‘¥ User Management</h4>
                <div class="endpoint"><span class="method get">GET</span> /api/users/online - ì˜¨ë¼ì¸ ì‚¬ìš©ì</div>
                <div class="endpoint"><span class="method put">PUT</span> /api/users/status - ìƒíƒœ ì—…ë°ì´íŠ¸</div>
                <div class="endpoint"><span class="method get">GET</span> /api/users/{userId}/presence - ì‚¬ìš©ì ì ‘ì† ìƒíƒœ</div>
            </div>

            <div class="api-section">
                <h4>ğŸ”” Notification Services</h4>
                <div class="endpoint"><span class="method post">POST</span> /api/notifications/send - ì•Œë¦¼ ì „ì†¡</div>
                <div class="endpoint"><span class="method get">GET</span> /api/notifications/subscribe - í‘¸ì‹œ êµ¬ë…</div>
                <div class="endpoint"><span class="method websocket">WS</span> /ws/notifications - ì‹¤ì‹œê°„ ì•Œë¦¼</div>
            </div>

            <div class="api-section">
                <h4>ğŸ“Š Analytics & Monitoring</h4>
                <div class="endpoint"><span class="method get">GET</span> /api/stats/connections - ì—°ê²° í†µê³„</div>
                <div class="endpoint"><span class="method get">GET</span> /api/health - ì„œë¹„ìŠ¤ ìƒíƒœ</div>
                <div class="endpoint"><span class="method get">GET</span> /api/metrics - ì„±ëŠ¥ ë©”íŠ¸ë¦­</div>
            </div>

            <h3>ì„œë¹„ìŠ¤ ì •ë³´:</h3>
            <ul>
                <li>ì„œë¹„ìŠ¤: live-connect-backend</li>
                <li>í¬íŠ¸: 4000</li>
                <li>ë„¤ì„ìŠ¤í˜ì´ìŠ¤: live-connect</li>
                <li>API ì—”ë“œí¬ì¸íŠ¸: <a href="https://live-connect.back-end.kro.kr" style="color: #fbbf24;">live-connect.back-end.kro.kr</a></li>
                <li>í”„ë¡ íŠ¸ì—”ë“œ: <a href="https://live-connect.prod.kro.kr" style="color: #fbbf24;">live-connect.prod.kro.kr</a></li>
                <li>WebSocket ì§€ì›: ì‹¤ì‹œê°„ ì–‘ë°©í–¥ í†µì‹ </li>
                <li>WebRTC ì§€ì›: P2P ë¯¸ë””ì–´ ìŠ¤íŠ¸ë¦¬ë°</li>
            </ul>
        </div>
    </body>
    </html>